function storystart() {
	var players = storytime["PlayerNames"];
	var listplayers = storytime["PlayerIDs"];
	if(players) {
		if(Params != null) {
			if(storytime["PlayerIDs"].indexOf(RawUserID) > -1 || storytime.indexOf(RawUserID) > -1) {	
				msg = "You are already on an adventure.  Please finish your story before beginning a new one.";
			} else {
			var obj = {
				Choices: 0,
				Deaths: 0,
				Registered: true,
				Rewinds: 0,
				SetChoice: 0,
				GameType: "Single"
			};
		storytime[RawUserID] = str(obj);
		msg ="You have begun your solo adventure.  Next up is your genre selection.  Use, `st?genre` to see a list of the available genre's.";
		};
			} else {
			if(storytime["TotalPlayers"] == 5) {
				var players = prs(storytime["PlayerNames"]);
				for(i = 0; i < players.length; i++) {
				names += players[i] + ","
				}
				msg = "Sorry but the group is full.  Players are: " + names;
			} else {
				if(storytime["PlayerIDs"].indexOf(RawUserID) > -1) {
					msg = "You've already registered to the system.";
				} else {
				storytime["TotalPlayers"]++;
				storytime["PlayerIDs"] = storytime["PlayerIDs"].slice(0, -1) + ', "' + UserID + '"]';
				storytime["PlayerNames"] = storytime["PlayerNames"].slice(0, -1) + ', "' + Username + '"]';
				var obj = {
					Choices: 0,
					Deaths: 0,
					Registered: true,
					Rewinds: 0,
					SetChoice: 0,
					GameType: "Group"
				};
				storytime[RawUserID] = str(obj);			
				msg = "You have been added to the list, " + Username + ".  There are a total of " + storytime["TotalPlayers"] + " signed up!";
				};		
			};
			};
		} else {
			if(Params != null) {
				if(storytime["PlayerIDs"].indexOf(RawUserID) > -1 || storytime.indexOf(RawUserID) > -1) {	
				msg = "You are already on an adventure.  Please finish your story before beginning a new one.";
				} else {
					var obj = {
						Choices: 0,
						Deaths: 0,
						Registered: true,
						Rewinds: 0,
						SetChoice: 0,
						GameType: "Single"
					};
					storytime[RawUserID] = str(obj);
					msg ="You have begun your solo adventure.  Next up is your genre selection.  Use, `st?genre` to see a list of the available genre's.";
				};
			} else {
					if(storytime["PlayerIDs"].indexOf(RawUserID) > -1 || storytime.indexOf(RawUserID) > -1) {	
						msg = "You are already on an adventure.  Please finish your story before beginning a new one.";				
					} else {
					storytime["ChoiceSet"] = 1;
					storytime["TotalPlayers"] = 1;
					storytime["PlayerIDs"] = '["' + UserID + '"]';
					storytime["PlayerNames"] = '["' + Username + '"]';
					msg = "You have begun the list, " + Username + " now get your friends to join!";
						var obj = {
							Choices: 0,
							Deaths: 0,
							Registered: true,				
							Rewinds: 0,
							SetChoice: 0,
							GameType: "Group"
						};
				storytime[RawUserID] = str(obj);
				};
			};
			};
			};
	return msg;
};

function stchoice() {
if (storytime.hasOwnProperty(RawUserID) === false) {
	msg = "Sorry, but you aren't registered for the game.  Try back later once the current story has finished.";
	} else {		
		var choice = Params.toLowerCase();
		var Robj = prs(storytime[RawUserID]);
		var msg = "";
			if(Robj["GameType"] == "Group") {
				if(choice == "a" || choice == "b") {
					Robj["Choices"]++
					Robj["SetChoice"]++;
				
					msg = "You have made your choice.  The story will develop shortly.";
				} else {
						msg = "That is not a valid choice.  Please refer to your DM and submit again.";
						}
			storytime[RawUserID] = str(Robj);
			} else {
				if(choice == "a" || choice == "b") {
					Robj["Choices"]++;
					msg = "You have made your choice.  Please use the `st?continue` command to further the story's progression.";
				} else {
					msg = "That is not a valid choice.  Please refer to your DM and submit again.";
						};
					};
			};
		return msg;
};


function stcontinue() {
if (storytime.hasOwnProperty(RawUserID) === false) {
    msg = "Sorry, but you aren't registered for the game.  Try back later once the current story has finished.";
        } else {
			if(storytime["GameType"] == "Group") {
				var TP = Math.floor(parseInt(storytime["TotalPlayers"]) * parseInt(storytime["ChoiceSet"]));
				var pid = prs(storytime["PlayerIDs"]);
				var p = 0;
				var msg = "";
				for(i = 0; i < pid.length; i++) {
					var user = prs(storytime[pid[i]]);
					var iOa = parseInt(user.SetChoice);
					p += iOa;
				};
				if(p < TP) {
					msg = "Not all players have made a decision yet.  We are unable to continue.";
				} else {
					storytime["ChoiceSet"]++;
					msg = "All players have made a decision. Let us continue.";
						};
			} else {
			msg = "Let's move the story forward.";
					};
				};
	return msg;
};

function strewind () {
	if (storytime.hasOwnProperty(RawUserID) === false) {
		msg = "Sorry, but you aren't registered for the game.  Try back later once the current story has finished.";
	} else {
		if(storytime[RawUserID]["GameType"] === "Solo") {
			msg = "";
			var Robj = prs(storytime[RawUserID]);
				if (Robj.Rewinds <= 0) {
					msg = "You do not have any rewinds to use.  These will be given out in time....just don't make any shitty choices till then. :D ";
					} else {
					msg = "The story will rewind to your last decision path.  Choose wisely.";
					Robj["Rewinds"]--;
					};
		} else { 
			var TP = parseInt(storytime["TotalPlayers"]);
			var pid = JSON.parse(storytime["PlayerIDs"]);
			var p = 0;
			var msg = "";
			for(i = 0; i < pid.length; i++) {
				var user = JSON.parse(storytime[pid[i]]);
				var iOa = parseInt(user.Rewinds);
				p += iOa;
				}
			if(p < TP) {
				msg = "Sorry but the party does not have enough rewinds to use this yet.  Keep trying!";
			} else {
				msg = "The story shall take a step into the past, to your most recent past choice.  Good luck.";
			};
		};
	};
	return msg;
};
